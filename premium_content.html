<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Agent Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .gradient-bg {
            background-color: #0b1a20;
            background-image: linear-gradient(180deg, #1b262c 0%, #0b1a20 100%);
        }
        .btn-primary {
            @apply bg-yellow-500 text-gray-900 font-semibold py-3 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 hover:bg-yellow-600;
        }
        .container-card {
            @apply bg-gray-800 p-8 rounded-2xl shadow-xl border border-gray-700 max-w-4xl w-full mx-auto;
        }
        .hidden { display: none; }
    </style>
    <script type="module">
        import { auth, signOut } from "./firebaseAuth.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // UI elements
        const loadingEl = document.getElementById("loading");
        const mainContainer = document.getElementById("main-container");
        const premiumContentEl = document.getElementById("premium-content");
        const logoutBtn = document.getElementById("logoutBtn");

        function initializeAuthListener() {
            onAuthStateChanged(auth, (user) => {
                loadingEl.classList.add("hidden");

                if (!user || user.isAnonymous) {
                    console.log("❌ No authenticated user, redirecting to login page...");
                    window.location.href = './login.html';
                    return;
                }

                console.log("✅ User logged in:", user.email || user.uid);
                mainContainer.classList.remove("hidden");
                premiumContentEl.classList.remove("hidden");
            });

            logoutBtn.addEventListener("click", async () => {
                try {
                    await signOut(auth);
                    window.location.href = "./login.html";
                } catch (error) {
                    console.error("Logout error:", error);
                }
            });
        }

        window.onload = initializeAuthListener;
    </script>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 text-gray-200">
    <div id="loading" class="text-center p-6 text-xl font-medium">
        Checking login...
    </div>

    <div id="main-container" class="hidden max-w-4xl w-full space-y-8">
        <div id="premium-content" class="container-card hidden">
            <div class="flex flex-col sm:flex-row items-center justify-between mb-8">
                <h1 class="text-3xl font-extrabold text-gray-100 sm:text-4xl">
                    <span class="text-yellow-500">AI</span> Agent Dashboard
                </h1>
                <button id="logoutBtn" class="btn-primary mt-4 sm:mt-0 text-sm px-4 py-2">Log out</button>
            </div>
            
            <hr class="border-t-2 border-gray-700 my-8">

            <div id="ai-agent-section" class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-100 text-center">Your AI Agent</h2>
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-700 h-[600px] overflow-hidden">
                    <iframe 
                        src="https://app.relevanceai.com/agents/bcbe5a/2bf5cc2a-7929-4eda-84d0-8c3c9fa9fbfb/7302844c-15b5-4e6c-a9f4-7c162fd2afd4/share?hide_tool_steps=false&hide_file_uploads=false&hide_conversation_list=false&bubble_style=agent&primary_color=%23685FFF&bubble_icon=pd%2Fchat&input_placeholder_text=Type+your+message...&hide_logo=false&hide_description=false" 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        allow="microphone">
                    </iframe>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
